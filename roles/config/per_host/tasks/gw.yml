---
# vim: filetype=ansible:syntax=yaml:ts=2:sts=2:sw=2:expandtab:autoindent:nospell

- name: gw is a gateway system
  set_fact:
    roles: '{{ roles | combine({"gw": true, "ssh": true, "dhcpd": true}) }}'

- name: Load gw vars
  include_vars: gw.yml

- name: Set dhcpd config
  set_fact:
    dhcpd_config: '{{ dhcpd_config | combine(gw_dhcpd_config) }}'

- name: Set rad config
  set_fact:
    rad_config: '{{ rad_config | combine(gw_rad_config) }}'

- name: Set PF WAN interface
  set_fact:
    pf_variables: '{{ pf_variables | combine({"if_wan": "em0"}) }}'

- name: Set PF LAN interface
  set_fact:
    pf_variables: '{{ pf_variables | combine({"if_lan": "em1"}) }}'

- name: Set additional PF variables
  set_fact:
    pf_variables: '{{ pf_variables | combine(gw_pf_variables) }}'

- name: Set PF tables
  set_fact:
    pf_tables: '{{ pf_tables | combine(gw_pf_tables) }}'

- name: Set PF rules
  set_fact:
    pf_rules: '{{ pf_rules + gw_pf_rules }}'

- name: Set OpenBSD gateway sysctls
  set_fact:
    sysctls: '{{ sysctls + gw_sysctls }}'

- name: Set relayd tables
  set_fact:
    relayd_tables: '{{ relayd_tables | combine(gw_relayd_tables) }}'

- name: Set relayd protocols
  set_fact:
    relayd_protocols: '{{ relayd_protocols | combine(gw_relayd_protocols) }}'

- name: Set relayd relays
  set_fact:
    relayd_relays: '{{ relayd_relays | combine(gw_relayd_relays) }}'

- name: Queue services to start
  set_fact:
    services: '{{ services | combine({"start": ["slaacd"]}) }}'
